[
  {
    "category": "functional",
    "feature": "Integration",
    "description": "端到端集成测试：完整 Agent Loop 工具调用流程",
    "overallPass": true,
    "bdd": [
      {
        "scenario": "TodoWrite 返回更新后列表",
        "description": "通过 createTodoTools 创建注册表，TodoWrite 写入后返回更新后的完整列表",
        "steps": {
          "given": [
            "通过 createTodoTools() 创建工具注册表"
          ],
          "when": [
            "调用 executeTool 执行 TodoWrite 写入 2 个任务"
          ],
          "then": [
            "TodoWrite 返回 content 解析后 todos 包含 2 个任务",
            "任务内容与写入的一致",
            "tool_use_id 正确关联"
          ]
        },
        "passes": true
      },
      {
        "scenario": "多次覆盖写入",
        "description": "连续多次 TodoWrite 调用，每次整体替换，返回值反映最新状态",
        "steps": {
          "given": [
            "通过 createTodoTools() 创建工具注册表"
          ],
          "when": [
            "第一次 TodoWrite 写入 3 个任务",
            "第二次 TodoWrite 写入 1 个不同的任务"
          ],
          "then": [
            "第二次 TodoWrite 返回的 todos 只有 1 个任务",
            "任务内容是第二次写入的"
          ]
        },
        "passes": true
      },
      {
        "scenario": "getToolDefinitions 返回 TodoWrite Schema",
        "description": "createTodoTools 返回的 registry 包含 TodoWrite",
        "steps": {
          "given": [
            "通过 createTodoTools() 创建工具注册表"
          ],
          "when": [
            "调用 getToolDefinitions()"
          ],
          "then": [
            "返回包含 1 个 ToolDefinition",
            "名称为 'TodoWrite'",
            "包含 input_schema 字段"
          ]
        },
        "passes": true
      }
    ]
  }
]
