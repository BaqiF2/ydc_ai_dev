"""
ReAct改进版本演示
对比展示原始版本和改进版本的区别
"""
import sys
import os
sys.path.append(os.path.dirname(os.path.dirname(os.path.abspath(__file__))))

from simple_react import SimpleReAct
from improved_react import ReActAgent
from chat_models import openai_tongyi_chat_model


def compare_versions():
    """对比两个版本的ReAct实现"""
    print("=" * 80)
    print("ReAct实现改进对比演示")
    print("=" * 80)

    # 初始化LLM
    llm = openai_tongyi_chat_model()

    # 创建两个版本的实例
    simple_react = SimpleReAct(llm)
    improved_react = ReActAgent(llm)

    # 测试问题
    test_questions = [
        "我有10000元，黄金450元一克，能买多少克？",
        "5000元买股票，25元一股，能买多少股？",
        "当前美元兑人民币汇率是多少？"
    ]

    for i, question in enumerate(test_questions, 1):
        print(f"\n测试问题 {i}: {question}")
        print("-" * 60)

        print("\n🔍 简化版本执行过程:")
        simple_answer = simple_react.run(question)
        print(f"简化版本答案: {simple_answer}")

        print(f"\n🚀 改进版本执行过程:")
        improved_answer = improved_react.process_question(question)
        print(f"改进版本答案: {improved_answer}")

        print("\n" + "=" * 60)


def show_improvements():
    """展示主要改进点"""
    print("\n📊 ReAct实现主要改进点:")
    print("=" * 50)

    improvements = [
        "✅ 提示词工程优化 - 更详细的角色定义和格式指导",
        "✅ 模块化架构设计 - ToolExecutor、ReActParser、ReActAgent分离",
        "✅ 增强的错误处理 - 输入验证、异常捕获、安全机制",
        "✅ 日志记录系统 - 详细的执行过程跟踪",
        "✅ 类型安全 - 使用枚举和数据类",
        "✅ 更好的响应解析 - 支持多种格式和边界情况",
        "✅ 对话历史管理 - 保存完整的交互记录",
        "✅ 工具函数增强 - 更智能的搜索和计算",
        "✅ 代码可读性 - 清晰的命名和注释",
        "✅ 扩展性 - 易于添加新工具和特性"
    ]

    for improvement in improvements:
        print(f"  {improvement}")


def architecture_comparison():
    """架构对比"""
    print("\n🏗️ 架构对比:")
    print("=" * 50)

    print("原始版本架构:")
    print("""
    ┌─────────────────┐
    │   用户问题       │
    └─────────┬───────┘
              │
    ┌─────────▼───────┐
    │   简单提示词     │
    └─────────┬───────┘
              │
    ┌─────────▼───────┐
    │   LLM调用       │
    └─────────┬───────┘
              │
    ┌─────────▼───────┐
    │   简单解析       │
    └─────────┬───────┘
              │
    ┌─────────▼───────┐
    │   工具执行       │
    └─────────┬───────┘
              │
    ┌─────────▼───────┐
    │   循环判断       │
    └─────────────────┘
    """)

    print("\n改进版本架构:")
    print("""
    ┌─────────────────────────────────────────────────────────┐
    │                    用户问题                              │
    └────────────────────┬──────────────────────────────────────┘
                         │
    ┌────────────────────▼──────────────────────────────────────┐
    │                ReActAgent (智能体核心)                    │
    │  ┌─────────────────────────────────────────────────────┐  │
    │  │              改进版提示词系统                        │  │
    │  └────────────────────┬──────────────────────────────┘  │
    │                       │                                 │
    │  ┌────────────────────▼──────────────────────────────┐  │
    │  │              ReActParser (响应解析器)               │  │
    │  │  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐ │  │
    │  │  │ 思考提取    │ │ 动作解析    │ │ 答案提取    │ │  │
    │  │  └─────────────┘ └─────────────┘ └─────────────┘ │  │
    │  └────────────────────┬──────────────────────────────┘  │
    │                       │                                 │
    │  ┌────────────────────▼──────────────────────────────┐  │
    │  │            ToolExecutor (工具执行器)                │  │
    │  │  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐ │  │
    │  │  │ 搜索工具    │ │ 计算工具    │ │ 安全验证    │ │  │
    │  │  └─────────────┘ └─────────────┘ └─────────────┘ │  │
    │  └────────────────────┬──────────────────────────────┘  │
    │                       │                                 │
    │  ┌────────────────────▼──────────────────────────────┐  │
    │  │            日志系统 + 错误处理 + 历史记录           │  │
    │  └─────────────────────────────────────────────────────┘  │
    └────────────────────┬──────────────────────────────────────┘
                         │
    ┌────────────────────▼──────────────────────────────────────┐
    │                    LLM服务                                │
    └───────────────────────────────────────────────────────────┘
    """)


def main():
    """主函数"""
    print("🎯 ReAct实现改进演示")
    print("=" * 80)

    # 显示改进点
    show_improvements()

    # 架构对比
    architecture_comparison()

    # 实际对比演示
    compare_versions()

    print("\n✨ 演示完成！")
    print("\n建议:")
    print("1. 对于学习: 从 simple_react.py 开始")
    print("2. 对于项目: 使用 improved_react.py")
    print("3. 查看 README.md 了解详细改进说明")


if __name__ == "__main__":
    main()